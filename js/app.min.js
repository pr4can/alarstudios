(()=>{"use strict";document.addEventListener("DOMContentLoaded",(function(e){let t,n;const a=document.querySelector(".users__table"),s=a.querySelector(".table__body"),l=document.querySelector("#addUser"),r=l.querySelector(".form__error"),c=fetch("https://pr4can.github.io/alarstudios/files/users.json").then((e=>e.json())),i=e=>{const t=e.map((e=>`\n                <div data-id="${e.id}" class="table__row">\n                    <div class="table__column">\n                        <span>${e.name}</span>\n                        <input name="user-name" type="text" value="${e.name}">\n                    </div>\n                    <div class="table__column">\n                        <span>${e.phone}</span>\n                        <input name="user-phone" type="tel" value="${e.phone}">\n                    </div>\n                    <div class="table__column">\n                        <button class="table__btn btn btn--delete">Удалить</button>\n                        <button class="table__btn btn btn--edit">Редактировать</button>\n                        <button class="table__btn btn btn--success">Сохранить</button>\n                    </div>\n                </div>\n            `));s.innerHTML=t.join(""),document.querySelectorAll("[type='tel']").forEach((e=>e.addEventListener("input",u,!1)))};function o(e){return/^(\+7|7|8)?[\s\-]?\(?[489][0-9]{2}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/.test(e)}function u(e){let t="+7(___)___-__-__",n=0,a=t.replace(/\D/g,""),s=this.value.replace(/\D/g,"");a.length>=s.length&&(s=a),t=t.replace(/[_\d]/g,(function(e){return s.charAt(n++)||"_"})),this.value=t,n=t.lastIndexOf(s.substr(-1)),n<t.length&&t!=this.defaultValue?n++:n=t.indexOf("_"),function(e,t){if(t.focus(),t.setSelectionRange)t.setSelectionRange(e,e);else if(t.createTextRange){let n=t.createTextRange();n.collapse(!0),n.moveEnd("character",e),n.moveStart("character",e),n.select()}}(n,this)}(async()=>{n=await c,i(n)})(),a.addEventListener("click",(function(e){let a=e.target;if(a.classList.contains("btn--edit")&&(e.preventDefault(),t&&t.classList.remove("table__row--edit"),t=a.parentElement.parentElement,t.classList.add("table__row--edit")),a.classList.contains("btn--delete")&&(e.preventDefault(),t=a.parentElement.parentElement,(async e=>{n=n.filter((t=>t.id!==e)),t.remove(),t=null})(t.dataset.id)),a.classList.contains("btn--success")){e.preventDefault();let a=t.dataset.id,s=t.querySelector("input[name='user-name']").value,l=t.querySelector("input[name='user-phone']").value;s&&o(l)?(t.classList.remove("table__row--error"),(async(e,a,s)=>{const l=n.find((t=>t.id===e));l.name=a,l.phone=s.replace(/\D/g,""),i(n),t=null})(a,s,l)):t.classList.add("table__row--error")}})),l.addEventListener("submit",(function(e){e.preventDefault(),this.name.value&&o(this.phone.value)?(r.style.display="none",(async(e,t)=>{const a={id:Date.now(),name:e,phone:t.replace(/\D/g,"")};n.push(a),i(n)})(this.name.value,this.phone.value),l.reset()):r.style.display="block"}))}))})();